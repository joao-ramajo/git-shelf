<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Shelf</title>
    <link href="./css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.0/css/all.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body>
    <header class="bg-stone-900 text-white  flex justify-between items-center px-16 py-6">
        <p class="text-3xl"><i class="fab fa-github "></i>Git Shelf teste</p>
    </header>

    <section class="min-h-3/6 w-full px-16 rounded">
        <div x-data="{
            repositories: [],
            data: [],
            name: '',
            page: 0,
            isLoading: false,
            get hasNextPage() {return this.page + 1 < this.data.length},
            hasLastPage: '',
            get disabled() { return this.name === '' || this.isLoading },
            getRepositories: async function() {
                if(!this.name){
                    console.log('nome vazio')
                    return
                }
                this.isLoading = true;
                var result = await(await fetch(`http://localhost:8080/?name=${encodeURI(this.name)}&action=json`)).json();
                // [[5],[5],[5]]
                this.repositories = result
                var limit = 2
                for(let i = 0; i < result.data.length; i += limit)
                {
                    this.data.push(result.data.slice(i, i + limit))
                }
                console.log(this.data)
                this.isLoading = false;
            }
         }">
            <div class="flex justify-between my-5 px-5">
                <div class="flex gap-3">
                    <span class="border border-b-emerald-950 px-3.5 py-1.5 rounded">
                        @
                        <input type="text" x-model="name" @keydown.enter="getRepositories()" class="focus:outline-none">
                    </span>
                    <button @click="getRepositories()"
                        class="rounded border px-3.5 py-1.5 bg-green-500 border-green-600 text-white inline-flex items-center gap-1 disabled:opacity-50"
                        x-bind:disabled="disabled
                    ">
                        <i class="fa-solid fa-magnifying-glass"></i><span>Procurar</span>
                    </button>
                </div>
                <div class="flex gap-2">
                    <p>
                        <button
                            class="bg-blue-50  border border-blue-500  enabled:hover:cursor-pointer  text-blue-500 disabled:opacity-50  px-3.5 py-1.5 rounded"
                            @click="page--" x-bind:disabled="page === 0">Voltar</button>
                        Páginas <span x-text="page + 1"></span> de <span x-text="data.length === 0  ? '1' : data.length"></span>
                        <button
                            class="bg-blue-50  border border-blue-500  text-blue-500 disabled:opacity-50 enabled:hover:cursor-pointer   px-3.5 py-1.5 rounded"
                            @click="page++"
                            x-bind:disabled="!hasNextPage">Próxima página</button>
                    </p>
                    <p
                        class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium bg-gray-700 text-gray-200 ring-1 ring-gray-600/20 ring-inset"
                        x-bind:class="data.length >= 1 ? 'inline-flex items-center rounded-md  px-2 py-1 text-xs font-medium bg-green-50 text-green-700 ring-1 ring-green-600/20 ring-inset' : 'opacity-50'
                    ">
                        Resultados encontrado: <span x-text="repositories.total_repositories ? repositories.total_repositories : '0' "></span>
                    </p>
                </div>
            </div>
            <table class="table-auto mx-auto rounded-md mt-8 w-full">
                <thead class="shadow-none outline-none">
                    <tr class="">
                        <th class="py-2 px-4 border-b border-b-gray-300 text-left font-light text-2xl  w-60">Repositorio
                        </th>
                        <th class="py-2 px-4 border-b border-b-gray-300 text-left font-light text-2xl">Descrição</th>
                        <th class="py-2 px-4 border-b border-b-gray-300 text-left font-light text-2xl">Tecnologias</th>
                    </tr>
                </thead>
                <tbody x-show="isLoading">
                    <tr class="h-24 overflow-scroll">
                        <td class="py-2 px-4 border-b border-b-gray-300 font-light">Buscando informações</td>
                        <td class="py-2 px-4 border-b border-b-gray-300 font-light">Sabia que nosso backend é apenas em
                            PHP ?</td>
                        <td class="py-2 px-4 border-b border-b-gray-300 font-light"></td>
                    </tr>
                </tbody>
                <tbody x-show="!isLoading">
                    <template x-for="(item) in data[page]">
                        <tr class="h-14 overflow-scroll ">
                            <td class="py-2 px-4 border-b border-b-gray-300 font-light" x-text="item.name"></td>
                            <td class="py-2 px-4 border-b border-b-gray-300 font-light" x-text="item.description"></td>
                            <td class="py-2 px-4 border-b border-b-gray-300 font-light" x-text="item.language"></td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </section>
</body>

</html>